<!doctype html>
<html lang="vi">

<head>
  <%- include(layouts + '/head'); %>

  <link rel="stylesheet" href="/css/products/view.css">
</head>

<body id="product-view-page">
  <%- include(layouts + '/header'); %>

  <main>
    <div class="container">
      <div class="row gx-0 product-view">
        <div class="col-12 col-lg-6">
          <div class="featured-image">
            <div class="featured-image-img" style="background-image: url('/images/product/featured-image.jpg')"></div>
          </div>
        </div>

        <div class="col-12 col-lg-6">
          <div class="product-info">
            <h2 class="title">
              <a><%= product.name %></a>
            </h2>

            <%- include(views + "/products/components/rating-stars", {
              totalRatings: product.totalRatings,
              ratingAvg: product.ratingAvg
            }); %>

            <%- include(views + "/products/components/price", {
              price: product.price,
              discount: product.discount
            }); %>

            <p class="description">
              <%= product.description %>
            </p>

            <div class="number-of-product">
              <label>Số lượng :</label>

              <div class="input-quantity" style="flex: 1;">
                <a class="input-quantity-action" id="dec-quantity">
                  <i class="fas fa-minus"></i>
                </a>

                <div class="input-quantity-value">
                  <span>
                    <input type="number" id="quantity" value="1" class="text-center hide-spin-button"><strong>sản phẩm</strong>
                  </span>
                </div>

                <a class="input-quantity-action" id="inc-quantity">
                  <i class="fas fa-plus"></i>
                </a>
              </div>
            </div>

            <button class="btn-daminest primary" id="btn-add-to-cart">
              <i class="fas fa-shopping-cart" style="margin-right: 8px"></i>Thêm vào giỏ hàng
            </button>
          </div>
        </div>
      </div>

      <div class="properties">
        <h3 class="heading">
          Thông tin chi tiết
          <span></span>
        </h3>

        <%- include(views + "/products/components/product-property-item", { label: "Thành phần", value: product.ingredient }); %>
        <%- include(views + "/products/components/product-property-item", { label: "Khối lượng", value: product.mass }); %>
        <%- include(views + "/products/components/product-property-item", { label: "Công dụng", value: product.uses }); %>
        <%- include(views + "/products/components/product-property-item", { label: "Bảo quản", value: product.preservation }); %>
        <%- include(views + "/products/components/product-property-item", { label: "Hạn sử dụng", value: product.expiryDate }); %>
        <%- include(views + "/products/components/product-property-item", { label: "Xuất xứ", value: product.origin }); %>

        <div class="property-item">
          <label class="property-item-label">Sản phẩm của Công Ty TNHH MTV Yến Sào DaniNest</label>
          <span class="property-item-value">Địa chỉ : KTX Khu B - ĐHQG HCM, Linh Trung, Thủ Đức, HCM</span>
          <span class="property-item-value">Hotline : 0777 888 148</span>
        </div>

        <div class="commitment">
          <div class="row gx-3">
            <div class="col-12 col-md-4">
              <div class="commitment-item">
                <i class="fas fa-shipping-fast"></i>
                <span>Miễn phí giao hàng</span>
              </div>
            </div>

            <div class="col-12 col-md-4">
              <div class="commitment-item">
                <i class="fas fa-award"></i>
                <span>Đảm bảo chất lượng 100%</span>
              </div>
            </div>

            <div class="col-12 col-md-4">
              <div class="commitment-item">
                <i class="fas fa-reply"></i>
                <span>Đổi trả trong vòng 30 ngày</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="related-products">
        <h3 class="heading heading-reverse">
          Sản phẩm liên quan
          <span></span>
        </h3>

        <div class="row gx-3 gy-3">
          <% relatedProducts.forEach(function(relatedProduct) { %>
            <div class="col-12 col-md-4">
              <%- include(views + '/products/components/product-item', { product: relatedProduct }); %>
            </div>
          <% }); %>
        </div>
      </div>
    </div>
  </main>

  <%- include(layouts + '/footer'); %>
  <%- include(layouts + '/foot'); %>

  <script type="text/javascript">
    const MIN_QUANTITY = 1;
    const MAX_QUANTITY = 10;

    function getQuantity () {
      return parseInt($('#quantity').val());
    }

    function updateQuantity (value) {
      const current = getQuantity();
      if ((value < 0 && current > MIN_QUANTITY) || (value > 0 && current < MAX_QUANTITY)) {
        $('#quantity').val(current + value);
      }
    }

    $(document).ready(function () {
      $('#navPrimary [itemid="products"]').addClass('active');

      $('#inc-quantity').on('click', function () {
        updateQuantity(1);
      });

      $('#dec-quantity').on('click', function () {
        updateQuantity(-1);
      });

      $('#btn-add-to-cart').on('click', function () {
        const quantity = getQuantity();

        toastr.info("Đang thêm vào giỏ hàng");

        $.ajax({
          url: '/checkout/cart/add',
          type: 'PUT',
          data: {
            productId: '<%= product._id %>',
            quantity: quantity
          },
          success: function (data) {
            console.log('addToCart -> Success', data);
            cartLS.add(data, quantity);
            toastr.success("Đã thêm vào giỏ hàng");
          },
          error: function (error) {
            console.log('addToCart -> Error', error);
            toastr.error("Lỗi thêm vào giỏ hàng");
          }
        });
      });

      cartLS.onChange(function (items) {
        updateCartBadge();
      });
    });
  </script>
</body>

</html>
